datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

// Content discovery and curation
model Source {
  id          String   @id @default(uuid())
  name        String
  type        String   // reddit, rss, manual
  config      String   // JSON config
  schedule    String?  // Cron expression
  lastRunAt   DateTime?
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  ideas       Idea[]
}

model Idea {
  id          String   @id @default(uuid())
  sourceId    String
  source      Source   @relation(fields: [sourceId], references: [id])
  
  title       String
  content     String   // Raw scraped content
  url         String?
  metadata    String   // JSON: author, score, comments, etc.
  
  aiScore     Float?   // 0-100 relevance score
  aiSummary   String?
  
  status      String   @default("pending") // pending, reviewing, approved, rejected, assigned
  assignedTo  String?  // Workflow ID
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  projects    Project[]
}

// Video production
model Project {
  id          String   @id @default(uuid())
  ideaId      String?
  idea        Idea?    @relation(fields: [ideaId], references: [id])
  
  name        String
  workflow    String   // reddit_to_video, blog_to_video, visual_content
  status      String   @default("idea") // idea, script_draft, script_approved, voice_generating, avatar_generating, broll_generating, rendering, complete, failed
  
  // Content
  script      Script?
  assets      Asset[]
  renders     RenderJob[]
  
  // Output
  finalVideoUrl   String?
  thumbnailUrl    String?
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model Script {
  id          String   @id @default(uuid())
  projectId   String   @unique
  project     Project  @relation(fields: [projectId], references: [id])
  
  rawText     String   // Original input
  segments    ScriptSegment[]
  fullScript  String   // Generated script
  
  approved    Boolean  @default(false)
  approvedAt  DateTime?
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model ScriptSegment {
  id          String   @id @default(uuid())
  scriptId    String
  script      Script   @relation(fields: [scriptId], references: [id])
  
  index       Int
  text        String
  duration    Float?   // Seconds (from Whisper)
  
  // Timing for video assembly
  startTime   Float?   // Start in final video
  endTime     Float?   // End in final video
  
  // Visual assignment
  visualType  String   @default("avatar") // avatar, broll, screen, image, text
  assetId     String?
  asset       Asset?   @relation(fields: [assetId], references: [id])
  
  createdAt   DateTime @default(now())
}

model Asset {
  id          String   @id @default(uuid())
  projectId   String
  project     Project  @relation(fields: [projectId], references: [id])
  
  type        String   // voice, avatar_video, broll_video, image, music, subtitle
  provider    String   // elevenlabs, heygen, kieai, wan, upload, whisper
  status      String   @default("pending") // pending, generating, ready, failed
  
  // Storage
  localPath   String?
  driveUrl    String?
  
  // Provider-specific
  providerJobId   String?
  providerUrl     String?
  
  // Metadata
  duration    Float?
  fileSize    Int?
  mimeType    String?
  
  segments    ScriptSegment[]
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model RenderJob {
  id          String   @id @default(uuid())
  projectId   String
  project     Project  @relation(fields: [projectId], references: [id])
  
  type        String   // preview, final_1080p, final_4k, short_9_16
  status      String   @default("queued") // queued, processing, complete, failed, cancelled
  
  // Progress
  progress    Int      @default(0) // 0-100
  currentStep String?
  
  // Results
  outputUrl   String?
  error       String?
  
  // Timing
  startedAt   DateTime?
  completedAt DateTime?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}